<!DOCTYPE html>
<html>
<head>
  <title>Mini E-commerce</title>
</head>
<body>
  <h1>ðŸ›’ Mini E-commerce Store</h1>

  <h2>Login</h2>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
  <p id="loginStatus"></p>

  <h2>All Products</h2>
  <button onclick="loadProducts()">Load Products</button>
  <ul id="productList"></ul>

  <h2>Add Product (Admin Only)</h2>
  <input id="pname" placeholder="Name">
  <input id="pdesc" placeholder="Description">
  <input id="pprice" placeholder="Price">
  <input id="pcat" placeholder="Category">
  <button onclick="addProduct()">Add Product</button>

  <h2>Cart</h2>
  <button onclick="viewCart()">View Cart</button>
  <ul id="cartList"></ul>

  <button onclick="placeOrder()">Place Order</button>

  <h2>Orders</h2>
  <button onclick="viewOrders()">View My Orders</button>
  <ul id="orderList"></ul>

  <script>
    let token = "";

    function login() {
      fetch("/api/auth/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          email: document.getElementById("email").value,
          password: document.getElementById("password").value
        })
      })
      .then(res => res.json())
      .then(data => {
        token = data.token;
        document.getElementById("loginStatus").innerText = "âœ… Logged in!";
      })
      .catch(() => alert("âŒ Login failed"));
    }

    function loadProducts() {
      fetch("/api/products")
        .then(res => res.json())
        .then(products => {
          const list = document.getElementById("productList");
          list.innerHTML = "";
          products.forEach(p => {
            const li = document.createElement("li");
            li.innerHTML = `${p.name} - â‚¹${p.price} 
              <button onclick="addToCart('${p._id}')">Add to Cart</button>`;
            list.appendChild(li);
          });
        });
    }

    function addProduct() {
      fetch("/api/products", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`
        },
        body: JSON.stringify({
          name: document.getElementById("pname").value,
          description: document.getElementById("pdesc").value,
          price: Number(document.getElementById("pprice").value),
          category: document.getElementById("pcat").value
        })
      })
      .then(res => res.json())
      .then(data => alert("âœ… Product added"))
      .catch(() => alert("âŒ Failed"));
    }

    function addToCart(productId) {
      fetch("/api/cart", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`
        },
        body: JSON.stringify({
          productId,
          quantity: 1
        })
      })
      .then(() => alert("ðŸ›’ Added to cart"))
      .catch(() => alert("âŒ Add to cart failed"));
    }

    function viewCart() {
      fetch("/api/cart", {
        headers: { Authorization: `Bearer ${token}` }
      })
      .then(res => res.json())
      .then(data => {
        const list = document.getElementById("cartList");
        list.innerHTML = "";
        (data.items || []).forEach(item => {
          const li = document.createElement("li");
          li.innerText = `${item.productId.name} x ${item.quantity}`;
          list.appendChild(li);
        });
      });
    }

    function placeOrder() {
      fetch("/api/orders", {
        method: "POST",
        headers: { Authorization: `Bearer ${token}` }
      })
      .then(res => res.json())
      .then(data => alert("âœ… Order placed"))
      .catch(() => alert("âŒ Order failed"));
    }

    function viewOrders() {
      fetch("/api/orders", {
        headers: { Authorization: `Bearer ${token}` }
      })
      .then(res => res.json())
      .then(orders => {
        const list = document.getElementById("orderList");
        list.innerHTML = "";
        orders.forEach(order => {
          const li = document.createElement("li");
          li.innerText = `ðŸ§¾ Order with ${order.items.length} items, Total: â‚¹${order.totalPrice}`;
          list.appendChild(li);
        });
      });
    }
  </script>
</body>
</html>
